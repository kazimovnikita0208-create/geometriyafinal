/**
 * –ü—Ä–æ—Å—Ç–æ–π Telegram-–±–æ—Ç –¥–ª—è —Å—Ç—É–¥–∏–∏ "–ì–µ–æ–º–µ—Ç—Ä–∏—è"
 * –° –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è Mini App
 */

const TelegramBot = require('node-telegram-bot-api');

// –¢–æ–∫–µ–Ω –±–æ—Ç–∞ (–ø–æ–ª—É—á–µ–Ω –æ—Ç BotFather)
const BOT_TOKEN = '8486427372:AAEDwcPL0pt3WCAc8JT1JwY-TKZqn3ZsbLM';

// URL Mini App - –∑–∞–¥–µ–ø–ª–æ–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Vercel
const MINI_APP_URL = 'https://frontend-phi-mocha-55.vercel.app';

// –°–æ–∑–¥–∞—ë–º –±–æ—Ç–∞
const bot = new TelegramBot(BOT_TOKEN, { polling: true });

console.log('ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!');

// –ö–æ–º–∞–Ω–¥–∞ /start
bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  const firstName = msg.from.first_name || '–¥—Ä—É–≥';
  
  const welcomeMessage = `
üëã –ü—Ä–∏–≤–µ—Ç, ${firstName}!

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å—Ç—É–¥–∏—é —Ç–∞–Ω—Ü–µ–≤ –∏ —Ä–∞—Å—Ç—è–∂–∫–∏ *¬´–ì–µ–æ–º–µ—Ç—Ä–∏—è¬ª*! üíú

üè¢ –ù–∞—à–∏ –∑–∞–ª—ã:
üìç —É–ª. –í–æ–ª–≥–∏–Ω–∞, 117–ê
üìç –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, 43, –¢–û–¶ "–û—Ö–æ—Ç–Ω—ã–π —Ä—è–¥"

üíÉ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
‚Ä¢ Pole Dance
‚Ä¢ Exotic Pole Dance  
‚Ä¢ –†–∞—Å—Ç—è–∂–∫–∞
‚Ä¢ –í–æ–∑–¥—É—à–Ω—ã–µ –ø–æ–ª–æ—Ç–Ω–∞
‚Ä¢ –•–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—è

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ! ‚¨áÔ∏è
  `.trim();
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è Mini App
  bot.sendMessage(chatId, welcomeMessage, {
    parse_mode: 'Markdown',
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: 'üì± –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
            web_app: { url: MINI_APP_URL }
          }
        ],
        [
          { text: 'üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã', callback_data: 'contacts' },
          { text: '‚ÑπÔ∏è –ü–æ–º–æ—â—å', callback_data: 'help' }
        ]
      ]
    }
  });
});

// –ö–æ–º–∞–Ω–¥–∞ /help
bot.onText(/\/help/, (msg) => {
  const chatId = msg.chat.id;
  
  const helpMessage = `
üìñ *–ü–æ–º–æ—â—å*

üîπ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" –¥–ª—è:
  ‚Ä¢ –ó–∞–ø–∏—Å–∏ –Ω–∞ –∑–∞–Ω—è—Ç–∏—è
  ‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
  ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–º
  ‚Ä¢ –û—Ç–º–µ–Ω—ã –∑–∞–ø–∏—Å–µ–π

üìû *–ö–æ–Ω—Ç–∞–∫—Ç—ã:*
‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: +7 (XXX) XXX-XX-XX
‚Ä¢ Instagram: @geometriya_dance

‚è∞ *–ü—Ä–∞–≤–∏–ª–∞ –æ—Ç–º–µ–Ω—ã:*
‚Ä¢ –í–µ—á–µ—Ä–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è - –æ—Ç–º–µ–Ω–∞ –∑–∞ 4 —á–∞—Å–∞
‚Ä¢ –î–Ω–µ–≤–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è - –æ—Ç–º–µ–Ω–∞ –¥–æ 21:00 –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–Ω—è
  `.trim();
  
  bot.sendMessage(chatId, helpMessage, {
    parse_mode: 'Markdown',
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: 'üì± –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
            web_app: { url: MINI_APP_URL }
          }
        ]
      ]
    }
  });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏
bot.on('callback_query', (query) => {
  const chatId = query.message.chat.id;
  const data = query.data;
  
  // –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ callback query (—É–±–∏—Ä–∞–µ—Ç "—á–∞—Å–∏–∫–∏" –Ω–∞ –∫–Ω–æ–ø–∫–µ)
  bot.answerCallbackQuery(query.id);
  
  switch (data) {
    case 'contacts':
      bot.sendMessage(chatId, `
üìû *–ö–æ–Ω—Ç–∞–∫—Ç—ã —Å—Ç—É–¥–∏–∏ "–ì–µ–æ–º–µ—Ç—Ä–∏—è"*

üìç *–ó–∞–ª—ã:*
‚Ä¢ —É–ª. –í–æ–ª–≥–∏–Ω–∞, 117–ê
‚Ä¢ –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, 43, –¢–û–¶ "–û—Ö–æ—Ç–Ω—ã–π —Ä—è–¥"

üì± –¢–µ–ª–µ—Ñ–æ–Ω: +7 (XXX) XXX-XX-XX
üì∏ Instagram: @geometriya_dance
üåê –°–∞–π—Ç: geometriya.ru (–µ—Å–ª–∏ –µ—Å—Ç—å)

‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ 10:00 - 22:00

–ë—É–¥–µ–º —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å –Ω–∞ –∑–∞–Ω—è—Ç–∏—è—Ö! üíú
      `.trim(), {
        parse_mode: 'Markdown'
      });
      break;
      
    case 'help':
      bot.sendMessage(chatId, `
‚ÑπÔ∏è *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è*

*–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ?*
1. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
2. –í—ã–±–µ—Ä–∏—Ç–µ "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
3. –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ª, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –≤—Ä–µ–º—è
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∑–∞–ø–∏—Å—å

*–ö–∞–∫ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ?*
1. –û—Ç–∫—Ä–æ–π—Ç–µ "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"
2. –ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ
3. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–º–µ–Ω–∏—Ç—å"
(–£—á–∏—Ç—ã–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –æ—Ç–º–µ–Ω—ã!)

*–í–æ–ø—Ä–æ—Å—ã?*
–ó–≤–æ–Ω–∏—Ç–µ: +7 (XXX) XXX-XX-XX
      `.trim(), {
        parse_mode: 'Markdown',
        reply_markup: {
          inline_keyboard: [
            [
              {
                text: 'üì± –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
                web_app: { url: MINI_APP_URL }
              }
            ]
          ]
        }
      });
      break;
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
bot.on('polling_error', (error) => {
  console.error('‚ùå –û—à–∏–±–∫–∞ polling:', error.code, error.message);
});

bot.on('error', (error) => {
  console.error('‚ùå –û—à–∏–±–∫–∞ –±–æ—Ç–∞:', error.message);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
process.on('SIGINT', () => {
  console.log('\nüëã –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
  bot.stopPolling();
  process.exit(0);
});

console.log('‚úÖ –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
console.log('üí° –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start –±–æ—Ç—É –≤ Telegram –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏');
console.log('\n‚ö†Ô∏è  –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–∏—Ç–µ MINI_APP_URL –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!');

